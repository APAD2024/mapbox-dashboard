<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>APAD Web Map</title>
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <!-- Link to external CSS file -->
  
    <link rel="stylesheet" href="src/css/styleguide.css" />
    <link rel="stylesheet" href="src/css/styles.css" />


    <link
      href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css"
      rel="stylesheet"
    />
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
    />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.1-dev/mapbox-gl-geocoder.min.js"></script>
    <link
      rel="stylesheet"
      href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.1-dev/mapbox-gl-geocoder.css"
      type="text/css"
    />

    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.5.0/turf.min.js"></script>
  </head>

  <body>
    <div class="dashboard">

      <!----------------------------------------------------------------- Header ----------------------------------------------------------->
      <div id="topBar">
        <!-- Left Section: Logo and Title -->
        <div class="left-section">
            <button id="menuButton" class="menu-btn" aria-label="Open menu">
              <img src="src/assets/menu-button.svg" alt="" class="icon" />
            </button>
            <img src="src/assets/logo.svg" alt="Logo" class="logo" />

            <!-- Dropdown Menu -->
            <ul id="menuList" class="menu-list hidden">
              <li><a href="https://apad.world/" target="_blank" rel="noopener">More Information</a></li>
              <li><a href="https://survey123.arcgis.com/share/491dccba7ed14379ab459551f96722ff" target="_blank" rel="noopener">Survey Form</a></li>
            </ul>
        </div>
        
        <!-- Right Section: Geocoder Search Bar + Filters -->
        <div class="right-section">
          <div class="geocoder-section">
            <!-- Geocoder Search Box Start -->
            <div id="geocoder"></div>
            <!-- Geocoder Search Box End -->
          </div>

          <!-- Right Section: Filters for Country and Asset -->
          <div class="filter-section">
            <div class="filter-container">
              <label for="polutantType" class="filter-label">Pollutant Type</label>
              <select id="polutantType" class="filter-select">
                <option value="">All</option>
                <option value="pm10">PM‚ÇÇ.‚ÇÖ</option>
                <option value="pm25">PM‚ÇÅ‚ÇÄ</option>
                <option value="so2">SO‚ÇÇ</option>
                <option value="nox">NO‚ÇÇ</option>
              </select>
            </div>

            <div class="filter-container">
              <label for="countryFilter" class="filter-label">Country</label>
              <select id="countryFilter" class="filter-select">
                <option value="">All</option>
              </select>
            </div>

            <div class="filter-container">
              <label for="assetFilter" class="filter-label">Asset Type</label>
              <select id="assetFilter" class="filter-select">
                <option value="">All</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      <!------------------------------------------------------------- Basemap Menu ------------------------------------------------------------------>
      <div class= "FAB" id="basemapMenuButton"><i class="fas fa-globe"></i></div>
      <div id="menu">
        <button class="closeButton">&times;</button>

        <input id="streets-v12" type="radio" name="rtoggle" value="streets-v12" />
        <label for="streets-v12">Streets</label><br />

        <input
          id="satellite-streets-v12"
          type="radio"
          name="rtoggle"
          value="satellite-streets-v12"
        />
        <label for="satellite-streets-v12">Satellite</label><br />

        <input
          id="outdoors-v12"
          type="radio"
          name="rtoggle"
          value="outdoors-v12"
        />
        <label for="outdoors-v12">Outdoors</label><br />

        <input
          id="light-v11"
          type="radio"
          name="rtoggle"
          value="light-v11"
          checked="checked"
        />
        <label for="light-v11">Light</label><br />

        <input id="dark-v11" type="radio" name="rtoggle" value="dark-v11" />
        <label for="dark-v11">Dark</label><br />

        <!-- New Option for Google Air Quality Map -->
        <input
          id="google-air-quality"
          type="radio"
          name="rtoggle"
          value="google-air-quality"
        />
        <label for="google-air-quality">Google Air Quality</label><br />
      </div>

      <!-- Heatmap Control Box -->
      <div
        id="heatmapBox"
        style="
          display: none;
          position: absolute;
          bottom: 100px;
          right: 20px;
          z-index: 100;
          background: white;
          padding: 15px;
          border-radius: 8px;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        "
      >
        <button class="closeButton">&times;</button>
        <label for="heatmapToggle">
          <strong>Heatmap</strong>
          <input type="checkbox" id="heatmapToggle" checked />
        </label>
        <div style="margin-top: 5px; display: flex; align-items: center">
          <span style="font-size: 12px">Poor</span>
          <div
            style="
              flex-grow: 1;
              height: 10px;
              background: linear-gradient(
                90deg,
                #7f0400 0%,
                #fa0f00 10.1%,
                #fa8c00 30.41%,
                #fdff00 49.98%,
                #83ce34 69.1%,
                #1a9e3a 100%
              );
              margin: 0 10px;
            "
          ></div>
          <span style="font-size: 12px">Excellent</span>
        </div>
      </div>

      <!-------------------------------------------------------- Continent Switch Button ------------------------------------------------------------->
      <div class= "FAB" id="areaChange" title="Move to Africa">
        <i class="fas fa-globe-africa"></i>
      </div>

      <!-------------------------------------------------------- Air Quality Button ------------------------------------------------------------->
      
      <div id="tooltipAQ" class="tooltip-hidden">
        Air Quality Data activated
      </div>

      <div class= "FAB" id="buttonOpenAQData" title="Button Air Quality Layer">
        <i class="fa-solid fa-wind" alt="Air quality icon"></i>
      </div>

      
      <!-------------------------------------------------------------- Aggregate Tool -------------------------------------------------------->
      <!-- Tooltip Element -->
      <div id="tooltip" class="tooltip-hidden">
        Click on the map to aggregate data within the selected buffer size.
      </div>

      <!-- Aggregate Tool -->
      <div id="aggregateToolContainer">
        <!-- Aggregate Tool Button -->
        <div class= "FAB" id="aggregateToolButton" title="Aggregate Data">
          <i class="fas fa-calculator"></i>
        </div>

        <!-- Buffer Size Dropdown -->
        <select
          id="bufferSizeSelector"
          title="Select Buffer Size"
          class="bufferSizeSelector-hidden">
          <option value="5">5 km</option>
          <option value="10">10 km</option>
          <option value="20">20 km</option>
          <option value="100" selected>100 km</option>
        </select>
      </div>

      <div id="aggregateResults"></div>

      <!----------------------------------------------------------------- Map ----------------------------------------------------------------------->

      <div id="map"></div>

      <!-- Loading spinner (add this inside the <body> of your HTML) -->
      <div id="loadingSpinner" class="loading-spinner" style="display: none">
        <div class="spinner"></div>
        <p>Loading layers...</p>
      </div>

      <!------------------------------------------------------------- Legend Layers ----------------------------------------------------------------->
      <div id="legendButton">Layers</div>
      
      <div id="legend">
        <button class="closeButton">&times;</button>

        <div class="legend-group">
          <div class="legend-group-title">Extraction or primary energy generation</div>
          <!-- Group 1: Extraction or primary energy generation -->
          
          <!-- Coal -->
          <div class="legend-section" id="legend-coal" draggable="true">
              <label class="custom-checkbox">
                  <input id="toggleCoal" type="checkbox" data-layer="coal" checked />
                  <span class="checkmark"></span>
              </label>
              <div class="legend-name">
                <img src="./src/assets/cross_coal.png" alt="Coal icon" class="legend-key-img"></img>
                <p>Coal</p>
              </div>
          </div>

            <!-- Fossil Fuel -->
            <div class="legend-section" id="legend-fossil" draggable="true">
              <label class="custom-checkbox">
                <input id="toggleFossil" type="checkbox"
                  data-layer="fossil" checked/>
                <span class="checkmark"></span>
              </label>
              <div class="legend-name">
                <img src="./src/assets/cross_fossil-fuel.png" alt="Fossil Fuel icon" class="legend-key-img"></img>
                <p>Fossil Fuel</p>
              </div>
            </div>

            <!-- Furnace Oil -->
            <div class="legend-section" id="legend-furnace-oil" draggable="true">
              <label class="custom-checkbox">
                <input id="toggleFurnaceOil" type="checkbox" data-layer="furnace_oil" checked/>
                <span class="checkmark"></span>
              </label>
              <div class="legend-name">
                <img src="./src/assets/cross_furnace-oil.png" alt="Furnace Oil icon" class="legend-key-img"></img>
                <p>Furnace Oil</p>
              </div>
            </div>
        </div>

        <div class="legend-group">
          <div class="legend-group-title"> Manufacturing or secondary energy generation</div>
            <!-- Group 2: Manufacturing or secondary energy generation -->

            <!-- Steel  -->
            <div class="legend-section" id="legend-steel-IGP" draggable="true">
              <label class="custom-checkbox">
                <input id="toggleSteel" type="checkbox" data-layer="steel_IGP" checked/>
                <span class="checkmark"></span>
              </label>
              <div class="legend-name">
                <div class="legend-key" style="width: 2rem; height: 2rem; background-color: hsla(205, 50%, 50%, 0.5); border: 0.1rem solid hsla(205, 50%, 50%, 1)"></div>
                <p>Steel</p>
              </div>
            </div>
            
            
            <!-- Paper Pulp -->
            <div class="legend-section" id="legend-paper-pulp" draggable="true">
              <label class="custom-checkbox">
                <input id="togglePaperPulp" type="checkbox" data-layer="paper_pulp" checked/>
                <span class="checkmark"></span>
              </label>
              <div class="legend-name">
                <div class="legend-key" style="width: 2rem; height: 2rem; background-color: hsla(356, 100%, 80%, 0.5); border: 0.1rem solid hsla(356, 100%, 80%, 1)" ></div>
                <p>Paper Pulp</p>
              </div>
            </div>

            <!-- Cement -->
              <div class="legend-section" id="legend-cement" draggable="true">
                <label class="custom-checkbox"> 
                  <input id="toggleCement" type="checkbox" data-layer="cement" checked/>
                  <span class="checkmark"></span>
                </label>  
                <div class="legend-name">
                  <div class="legend-key" style="width: 2rem; height: 2rem; background-color: hsla(115, 50%, 50%, 0.5); border: 0.1rem solid hsla(115, 50%, 50%, 1)" ></div>
                  <p>Cement</p>
                </div>
              </div>

            <!-- Boilers -->
            <div class="legend-section" id="legend-boilers" draggable="true">
              <label class="custom-checkbox"> 
                <input id="toggleBoilers" type="checkbox" data-layer="boilers" checked />
                <span class="checkmark"></span>
              </label>  
              <div class="legend-name">
                <div class="legend-key" style="width: 2rem; height: 2rem; background-color: hsla(356, 100%, 60%, 0.5); border: 0.1rem solid hsla(356, 100%, 60%, 1)" ></div>
                <p>Boilers</p>
              </div>
            </div> 

            <!-- Brick Kilns -->
            <div class="legend-section" id="legend-brickKiln" draggable="true">
              <label class="custom-checkbox"> 
                <input id="toggleBrickKiln" type="checkbox" data-layer="brickKiln" />
                <span class="checkmark"></span>
              </label>
              <div class="legend-name">
                <div class="legend-key" style="width: 0.5rem; height: 0.5rem; background-color: hsla(356, 100%, 30%, 1)" ></div>
                <p>Brick Kilns</p>
              </div>
            </div>

        </div>


        <div class="legend-group">
          <div class="legend-group-title">Waste management</div>
            <!-- Group 3: Tertiary or waste management -->

            <!-- Land Fill Waste -->
            <div class="legend-section" id="legend-land-fill-waste"     draggable= "true">
              <label class="custom-checkbox"> 
                <input id="toggleLandFillWaste" type="checkbox" data-layer="land_fill_waste" checked/>
                <span class="checkmark"></span>
              </label>
              <div class="legend-name">
                <img src="./src/assets/plus_land-fill-waste.png" alt="Land Fill Waste icon" class="legend-key-img"></img>
                <p>Land Fill Waste</p>
              </div>
            </div>
            
            <!-- GPW -->
            <div class="legend-section" id="legend-gpw" draggable="true">
              <label class="custom-checkbox">
                <input id="toggleGPW" type="checkbox" data-layer="gpw" checked/>
                <span class="checkmark"></span>
              </label>
              <div class="legend-name">
                <img src="./src/assets/plus_gpw.png" alt="GPW icon" class="legend-key-img"></img>
                <p>GPW</p>
              </div>
            </div>
        </div>

        <div class="legend-group">
          <div class="legend-group-title">Unregulated pollution</div>
          <!-- Group 4: Unregulated pollution -->

          <!-- Pollution Reports -->
          <div class="legend-section" id="legend-pollution" draggable="true">
            <label class="custom-checkbox">
              <input id="toggleReportedPollution" type="checkbox" data-layer="pollution_reports" checked/>
             <span class="checkmark"></span>
            </label>
            <div class="legend-name">
                <img src="./src/assets/star_open-waste-burning.png" alt="GPW icon" class="legend-key-img"></img>
                <p>Reported Pollution</p>
            </div>
        </div>



           

           <!-- Population Grid
          <div class="legend-section" id="legend-population" draggable="true">
            <input
              id="togglepop"
              type="checkbox"
              data-layer="population"
              checked
            />
            <span>Population Grid</span> <br />
            <span class="legend-subunit">Count / 800 m<sup>2</sup></span>

            <div class="row colors"></div>
            <div class="row labels">
              <div class="label">0</div>
              <div class="label"></div>
              <div class="label"></div>
              <div class="label"></div>
              <div class="label">17192</div>
            </div>
          </div> -->

          <!-- Pollutant Decay
          <div
            class="legend-section"
            id="legend-populationDecay"
            draggable="true"
          >
            <input
              id="toggledecay"
              type="checkbox"
              data-layer="population-decay"
            />
            <span>Pollutant Decay</span><br />
            <div class="rowdecay colorsdecay"></div>
            <div class="rowdecay labelsdecay">
              <div class="labeldecay">Min</div>
              <div class="labeldecay"></div>
              <div class="labeldecay"></div>
              <div class="labeldecay"></div>
              <div class="labeldecay">Max</div>
            </div>
          </div>  -->


          
        </div>
      </div>
      </div>

      <!--------------------------------------------------------- Brick Kiln ADM3 Filter Panel  ----------------------------------------------------->

      <div id="adm3FilterPanel" class="adm3-filter-panel">
        <h3 class="adm3-filter-title">üéØ Brick Kiln ADM3 Filter</h3>

        <label><strong>Country:</strong></label>
        <select id="adm3CountryFilter" class="adm3-select"></select>

        <label><strong>District:</strong></label>
        <select id="adm3DistrictFilter" class="adm3-select"></select>
      </div>

      <!--------------------------------------------------------- Pollutant Legend (Bottom Right) ----------------------------------------------------->
      <div id="pollutant-legend" class="pollutant-legend" style="display: none">
        <button class="closeButton">&times;</button>
        <div class="legend-title"></div>
        <div class="graduated-circles">
          <!-- Circle elements will be added here dynamically -->
        </div>
      </div>

      <!-------------------------------------------------------------- Hover Charts Display ---------------------------------------------------------->
      <!-- <div class="map-overlay" id="features">
        <h2>
          <i class="fas fa-chart-bar"></i>
          <span id="pollutantSourceTitle">Pollutants</span>
          <button id="collapseBtn" class="collapse-btn">-</button>
        </h2> -->

        <!-- Dropdown for selecting Per Year / Per Day -->
        <!-- <div id="dataFrequency">
          <select id="frequencySelect">
            <option value="year">Per Year</option>
            <option value="day">Per Day</option>
          </select>
        </div> -->

        <!-- <div id="chartContent"> -->
          <!-- Plant Name and Country Info -->
          <!-- <div id="plantInfo"></div> -->

          <!-- Canvas for the two charts -->
          <!-- <canvas id="pollutantChart1" width="400"></canvas>
          <canvas id="pollutantChart2" width="400"></canvas> -->

          <!-- Hover text -->
          <!-- <p id="hoverText">
            Hover over a Data and Check Details about Pollutants
          </p>
        </div> -->

        <!-- Expand Button (Initially hidden) -->
        <!-- <button id="expandBtn" class="expand-btn" style="display: none">
          Expand
        </button>
      </div>  -->
    
    </div>

    <!---------------------------------------------------------------- Scrpit JS------------------------------------------------------------------->
    <script type="module" src="src/js/main.js"></script>
    <script type="module" src="src/js/layers.js"></script>
    <script type="module" src="src/js/geocoder.js"></script>
    <script type="module" src="src/js/heatmapControls.js"></script>
    <script type="module" src="src/js/topbar.js"></script>
  </body>
</html>
